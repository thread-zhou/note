# 微服务架构

## 微服务架构三大要素

![Drawing 0.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\Ciqc1F9oF2eAWmXfAABGIP6n67s572.png)

### 微服务架构的第一要素：业务建模

微服务架构设计首要的切入点为服务建模。为什么我们首先需要考虑的是这个要素呢？因为微服务架构与传统 SOA 等技术体系有本质区别，就是其服务的粒度和服务本身的面向业务和组件化特性。针对服务建模，我们首先需要明确服务的类别，以及服务与业务之间的关系，尽可能明确领域的边界。

针对服务建模，推荐使用领域驱动设计（Domain Driven Design，DDD）方法，通过识别领域中的各个子域、判断这些子域是否独立、考虑子域与子域的交互关系，从而明确各个界限上下文（Boundary Context）之间的边界。

对于领域的划分，业界主流的分类方法认为，系统中的各个子域可以分成核心子域、支撑子域和通用子域三种类型，其中系统中的核心业务属于核心子域，专注于业务某一方面的子域称为支撑子域，可以作为某种基础设施的功能可以归到通用子域。例如：

![Drawing 1.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\CgqCHl9oGBeAbTgHAABTRP2uDhA258.png)

另一方面，服务建模本质上是一个为了满足业务需求，并通过技术手段将这些业务需求转换为可实现服务的过程。服务围绕业务能力建模，而业务能力往往体现的是一种分层结构。

按照我的经验，我们可以把业务体系中的服务分成如下几种类型：基础服务、通用服务、定制服务和其他服务等。这里，我们同样给出基于电商场景的业务服务分层示例图，如下所示：

![Drawing 2.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\CgqCHl9oGB-AXhkpAABlm8xE9Ik898.png)

### 微服务架构的第二要素：技术体系

八大技术体系，包括服务通信、服务治理、服务路由、服务容错、服务网关、服务配置、服务安全和服务监控，如下图所示：

![Drawing 3.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\CgqCHl9oGEeAdhDIAABR73xIec0986.png)

#### 1. 服务通信

网络通信是任何分布式系统的基础组件。网络通信本身涉及面很广，对于微服务架构而言，我们关注的是网络连接模式、I/O 模型和服务调用方式。

![Lark20200921-134148.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\CgqCHl9oPTWAez40AADTRo_y76k143.png)

- 例如 Dubbo 框架就采用的是长连接，而本课程中要介绍的 Spring Cloud 则采用了短连接。
- 在微服务架构中，以服务网关而言，像Netflix 的 Zuul就是阻塞式 I/O，而Spring 自研的 Spring Cloud Gateway则采用的是非阻塞式 I/O。
- 服务通信的另一个主题是调用方式，这方面同样存在同步调用和异步调用两大类实现机制。为了简化开发人员的使用过程，通常都会采用异步转同步的实现机制

#### 2.服务治理

独立的媒介来管理服务的实例，这个媒介一般被称为服务注册中心。

![Drawing 5.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\Ciqc1F9oGIiAKS7dAAAqT5bZobI453.png)

服务注册中心是保存服务调用所需的路由信息的存储仓库，也是服务提供者和服务消费者进行交互的媒介，充当着服务注册和发现服务器的作用。

#### 3.服务路由

我们现在已经通过注册中心构建了一个多服务的集群化环境中，当客户端请求到达集群，如何确定由哪一台服务器进行请求响应呢？这就是服务路由问题。可以认为负载均衡是最常见的一种路由方案，常见的客户端/服务器端负载均衡技术都可以完成服务路由。Spring Cloud 等主流的微服务框架也都内置了 Ribbon 等客户端负载均衡组件。

![Drawing 6.png](E:\Repository\Git\note\Spring Cloud原理与实战\assert\Ciqc1F9oGKyAXomhAAA9IT15qWs245.png)

另一方面，负载均衡的出发点更多的是提供服务分发而不是解决路由问题，常见的静态、动态负载均衡算法也无法实现精细化的路由管理。这时候我们就可以采用路由规则。<u>路由规则常见的实现方案是白名单或黑名单，即把需要路由的服务地址信息（如服务 IP）放入可以控制是否可见的路由池中进行路由。同样，路由规则也是微服务开发框架的一项常见功能。</u>

